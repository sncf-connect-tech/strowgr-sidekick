language: go

go:
  - 1.7
  - tip
gobuild_args: -ldflags "-X main.Version=$(cat $TRAVIS_BUILD_DIR/VERSION) -X GitCommit=$(git rev-parse --short HEAD) -X GitBranch=$(git rev-parse --abbrev-ref HEAD)"
before_script:
  - go vet sidekick
  - go test sidekick
script: go build -o "sidekick-$(cat $TRAVIS_BUILD_DIR/VERSION)" sidekick
install:
  - export GOPATH="${TRAVIS_BUILD_DIR}"

deploy:
  provider: releases
  api_key: "3c15c3b85c303197743bc0ca3c5a2ae5de314110"
  file: "sidekick-$(cat $TRAVIS_BUILD_DIR/VERSION)"
  skip_cleanup: true
  on:
    tags: true
                
